name: Build (Tkinter onefile)

on:
  push:
    branches: [ "main" ]
  workflow_dispatch:

permissions:
  contents: read

jobs:
  build-windows:
    name: Build Windows EXE (onefile)
    runs-on: windows-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"
          cache: "pip"

      - name: Install build tools
        shell: pwsh
        run: |
          python -m pip install --upgrade pip
          pip install --upgrade pyinstaller

      - name: Sanity check (tkinter)
        shell: pwsh
        run: |
          python -c "import tkinter as tk; print('tkinter OK:', tk.TkVersion)"

      # IMPORTANT:
      # - Replace YOUR_ENTRY_FILE.py with your actual entrypoint (e.g. main.py)
      # - If you have an icon, add: --icon app.ico
      - name: Build with PyInstaller (onefile)
        shell: pwsh
        run: |
          pyinstaller --noconfirm --clean --onefile --windowed `
            --name "TSD_Registry" `
            "YOUR_ENTRY_FILE.py"

      - name: Verify build output
        shell: pwsh
        run: |
          if (!(Test-Path "dist\TSD_Registry.exe")) {
            Write-Error "Build failed: dist\TSD_Registry.exe not found."
            exit 1
          }
          Get-Item "dist\TSD_Registry.exe" | Format-List *

      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with:
          name: TSD_Registry_Windows_onefile
          path: dist/TSD_Registry.exe
